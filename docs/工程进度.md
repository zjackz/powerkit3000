# 工程进度总览

## 1. 当前状态
- 项目处于 **MVP 验证阶段**：数据导入、查询服务、分析 API、Amazon 榜单模块与前端仪表盘可以联动，正补齐可视化与监控能力。
- 数据库 schema 稳定，最新迁移为 `AmazonModuleInit`；尚未引入自动化部署。
- 团队需关注配置管理（数据库连接、CORS、Amazon 抓取配置）、日志监控以及前端与 API 的数据契合度。

## 2. 里程碑跟踪
| 里程碑 | 目标内容 | 状态 | 备注 |
| --- | --- | --- | --- |
| MVP 数据通路 | 完成 CLI 导入、Postgres 入库、基础查询/统计 | 已完成 | CLI 命令与核心服务已落地并通过测试 |
| 分析 API 初版 | 提供项目列表、筛选、摘要与多维分析端点 | 已完成 | `backend/pk.api` 上线并接入 Swagger |
| 前端探索页 | React 列表 + 筛选 + 详情抽屉 + 指标卡 | 进行中 | 页面结构完成，统计图表与收藏导出待实现 |
| 多语言支持 | 提供中文名称/简介翻译与前端展示 | 已完成 | 新增 `translate` 命令及双语字段，等待接入真实 LLM Provider |
| Amazon 榜单模块 | Amazon 类目采集、趋势分析、报告与前端仪表盘 | 已完成 | 新增数据表、CLI 命令、API `/amazon/*` 端点与前端 Amazon 页面 |
| 中文注释规范 | 建立中文注释硬性校验流程 | 已完成 | 新增 `docs/AGENTS.md` 指引与 `scripts/validate-chinese-comments.sh` 校验脚本 |
| 运营监控 | 导入日志、失败重试、指标监控 | 未开始 | 需补充日志持久化与告警方案 |
| 协作能力 | 模板分享、导出、权限管理 | 未开始 | 依赖后续迭代规划 |

## 3. 模块进度
### 3.1 数据导入 CLI（`backend/pk.consoleapp`）
- **完成**：`import`、`split`、`counts`、`clear-db`、`metrics` 等命令；批量去重与结构化日志；`metrics` watch 模式可实时拉取 `/monitoring/metrics`、展示增量并针对导入失败/解析异常/慢查询发出预警。
- **进行中**：导入作业监控面板、批次重试策略及失败回放机制，准备将指标挂到统一看板并配置告警。
- **新增**：watch 输出解析错误 Top10 明细表，便于排查异常文件。

### 3.2 领域服务 Core（`backend/pk.core`）
- **完成**：`KickstarterDataImportService`、`KickstarterProjectQueryService`，支持多条件筛选与分析函数；导入流程增加字段校验并输出 `validation_errors` 指标；新增翻译抽象 `ITranslationService` 与多 Provider 框架。
- **待办**：指标缓存、查询性能调优、错误分类与告警接口；将校验失败记录落库或导出以辅助修复。

### 3.3 数据层（`backend/pk.data`）
- **完成**：实体建模（项目/创作者/分类/地点）、最新迁移与 DbContext 配置；`AddChineseFieldsToKickstarterProject` 迁移上线。
- **完成**：新增 Amazon 子域相关实体与 `AmazonModuleInit` 迁移（类目/产品/快照/数据点/趋势），建立索引与约束。
- **待办**：索引优化、数据字典维护、迁移脚本自动化。

### 3.4 分析 API（`backend/pk.api`）
- **完成**：主要 REST 端点、Swagger、CORS 配置、统计结果整合；列表与高光项目返回双语字段；新增 Serilog 结构化日志与 `/health` 健康检查；引入 `pk.api.tests` 集成测试基线；趋势信号接口 `/analytics/hype`（筹资速度榜）与 `/analytics/category-keywords`（关键词云）；新增 `/amazon/*` 端点覆盖类目同步、快照采集、趋势查询与报告输出。
- **进行中**：鉴权策略、错误响应规范化、监控指标外送与日志留存方案；`/monitoring/metrics` 已输出快照，下一步将接入统一看板并设定告警阈值。

### 3.5 前端应用（`frontend/tradeforge-suite`）
- **完成**：项目列表、筛选器、详情抽屉、统计卡、Mock 回退；服务层与 React Query 封装；新增中文优先显示及英文回退逻辑；分析图表组件初版上线；Dashboard 提供爆款潜力榜、筹资速度指标与品类关键词云；项目列表支持收藏/取消收藏并记录备注、收藏抽屉及一键筛选收藏视图；新增独立收藏页集中展示重点项目并支持检索与备注维护；上线 “Amazon 榜单” 页面呈现核心指标、榜单表格、趋势卡片与单品历史；交付 “客户演示” Demo 页面整合 Kickstarter 指标与 Amazon 热点（使用结构化假数据驱动）；Dashboard 新增“系统健康”卡片展示导入文件数、异常计数与慢查询告警，Control Tower（Next 版）同步复用该面板并扩展 Amazon 采集指标。 
- **进行中**：图表交互与空态提示优化、收藏/导出、指标趋势看板、API 错误提示体验、Amazon 历史趋势可视化增强；并行推进 Next.js + Ant Design Pro Control Tower 架构（`frontend/tradeforge-suite-next`）搭建、布局重构与指标组件升级。
- **新增规划**：迭代系统健康面板的 Amazon 指标（抓取成功率、重试次数）与外部告警通道，并评估将导入批次重试信息整合进驾驶舱。

### 3.6 Amazon 模块（跨后端/前端）
- **完成**：配置驱动的 Amazon 类目同步、`HtmlAgilityPack` 抓取实现、趋势分析服务、报告生成、CLI 命令与 API 联动、前端仪表盘。
- **待办**：引入代理/重试策略、抓取健康监控、告警通道、更多类目/站点支持。

## 4. 风险与阻塞
- **环境配置易错**：已新增 `appsettings.Company.json` 与 `appsettings.Home.json` 区分数据库连接，团队需在本地设置 `DOTNET_ENVIRONMENT` 并同步启动脚本检查 CORS。
- **缺少监控**：导入命令与 API 虽已输出结构化指标，但尚未接入集中看板与告警；需尽快落地 Grafana/Looker 等方案。
- **数据量增长后的性能风险**：查询与统计尚未建立索引策略，需在真实数据规模下压测。
- **前端依赖 API 结构**：若 API 变更未提前通知，可能导致前端回退至 Mock 数据，需建立契约评审流程。
- **翻译服务依赖外部 LLM**：目前默认 `noop` provider，用于结构验证；接入真实服务需关注配额、延迟与成本控制。

## 5. 下一迭代计划（建议）
1. 将 `/monitoring/metrics` 指标接入统一看板，设定告警阈值（导入失败/解析错误/慢查询）并串联通知渠道。
2. 在 API 层补充鉴权（临时可采用 API Key），并推进监控指标外送与日志留存。
3. 落地导入批次重试策略，完善校验失败的处理与追踪闭环。
4. 前端完善系统健康卡片的细化指标与空态/异常体验，并推进收藏导出流程。
5. 输出数据字典与字段解释，纳入 `docs/`；评估自动化部署流程（Docker 化或脚本化），明确环境切换步骤。

> 进度表建议在每次迭代评审后更新：标注完成事项、正在推进的故事、待解决的风险或依赖。EOF
